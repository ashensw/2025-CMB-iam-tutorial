asyncapi: '2.0.0'
info:
  title: 'Pizza Agent WebSocket API'
  version: 1.0.0
  description: |
    WebSocket-based Pizza Agent service for Pizza Shack.
    Provides AI-powered pizza ordering assistance with OAuth2 authentication.
  contact:
    name: Pizza Shack Support
    email: support@pizzashack.com
servers:
  production:
    url: wss://pizza-agent.choreoapis.dev
    protocol: wss
    description: Production Pizza Agent WebSocket server
  development:
    url: ws://localhost:8001
    protocol: ws
    description: Development Pizza Agent WebSocket server
channels:
  /chat:
    description: Main chat channel for pizza agent interactions
    parameters:
      session_id:
        description: Unique session identifier for the user
        schema:
          type: string
          pattern: '^[a-zA-Z0-9_-]+$'
    publish:
      operationId: ReceiveUserMessage
      summary: Receive messages from users
      description: |
        Receives chat messages from users. Can be plain text queries about menu,
        order requests, or control messages for order cancellation.
      message:
        $ref: '#/components/messages/UserMessage'
    subscribe:
      operationId: SendAssistantMessage
      summary: Send messages to users
      description: |
        Sends responses from the pizza agent, including menu information,
        order confirmations, authentication requests, and general chat responses.
      message:
        oneOf:
          - $ref: '#/components/messages/AssistantMessage'
          - $ref: '#/components/messages/AuthRequest'
components:
  messages:
    UserMessage:
      name: UserMessage
      title: User Message
      summary: Message sent by user to pizza agent
      contentType: application/json
      payload:
        type: object
        properties:
          type:
            type: string
            enum: ['message', 'order_cancel']
            default: 'message'
            description: Type of message being sent
          content:
            type: string
            description: The actual message content from the user
            examples:
              - "Show me the menu"
              - "I want to order a large margherita pizza"
              - "What pizza options do you have?"
        required:
          - content
        examples:
          - type: message
            content: "Show me the pizza menu please"
          - type: message
            content: "I'd like to order 2 large pepperoni pizzas for delivery"
          - type: order_cancel
            content: ""
    
    AssistantMessage:
      name: AssistantMessage
      title: Assistant Message
      summary: Message sent by pizza agent to user
      contentType: application/json
      payload:
        type: object
        properties:
          type:
            type: string
            const: 'message'
            description: Message type identifier
          content:
            type: string
            description: The response content from the pizza agent
            examples:
              - "üçï **Our Delicious Pizza Menu** üçï\n\n**Margherita Classic** - $12.99\nüìù Classic Italian pizza with fresh mozzarella and basil"
              - "üéâ **Order Confirmed!** üéâ\n\nüìã **Order ID**: PZ-2024-001\nüí∞ **Total**: $25.98"
          sender:
            type: string
            const: 'assistant'
            description: Identifies the sender as the assistant
        required:
          - type
          - content
          - sender
        examples:
          - type: message
            content: "üçï Welcome to Pizza Shack! I can help you browse our menu and place orders. What would you like today?"
            sender: assistant
    
    AuthRequest:
      name: AuthRequest
      title: Authentication Request
      summary: Authentication request sent to initiate OAuth flow
      contentType: application/json
      payload:
        type: object
        properties:
          type:
            type: string
            const: 'auth_request'
            description: Authentication request type identifier
          auth_url:
            type: string
            format: uri
            description: OAuth authorization URL for user to authenticate
            examples:
              - "https://api.asgardeo.io/oauth2/authorize?client_id=..."
          state:
            type: string
            description: OAuth state parameter for security
            examples:
              - "abc123def456"
          message:
            type: string
            description: Human-readable message explaining why auth is needed
            examples:
              - "To place your pizza order, please log in with your account."
        required:
          - type
          - auth_url
          - state
        examples:
          - type: auth_request
            auth_url: "https://api.asgardeo.io/oauth2/authorize?client_id=xyz&redirect_uri=http://localhost:8001/callback&state=abc123"
            state: "abc123def456"
            message: "To complete your pizza order, please authenticate with your Pizza Shack account."